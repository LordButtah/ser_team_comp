<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Team Competition Tracker</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #f8f9fa, #e0e0e0);
      padding: 30px;
      margin: 0;
      text-align: center;
    }

    h1 {
      margin-bottom: 30px;
      font-size: 2.5em;
      color: #333;
    }

    .team, .team-form, .login-form {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin: 20px auto;
      max-width: 500px;
      width: 90%;
      text-align: center;
    }

    .team-logo {
      max-height: 80px;
      margin-bottom: 10px;
    }

    .score {
      font-size: 1.4em;
      margin: 10px 0;
    }

    .edit-input {
      width: 80%;
      margin: 5px auto;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      display: block;
    }

    ul.member-list {
      list-style: none;
      padding: 0;
      margin-top: 10px;
    }

    ul.member-list li {
      background: #f1f1f1;
      margin: 4px auto;
      padding: 6px;
      border-radius: 6px;
      width: 80%;
    }

    button {
      margin: 5px;
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      background: #007bff;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #0056b3;
    }

    .hidden {
      display: none;
    }

    .login-form input {
      width: 80%;
      padding: 8px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .login-form button {
      background: #28a745;
    }

    .login-form button:hover {
      background: #218838;
    }
  </style>
</head>
<body>
  <h1>üèÜ Team Competition Tracker</h1>

  <div id="addEditContainer" class="team-form hidden">
    <input id="teamName" placeholder="Team Name"><br><br>
    <input id="teamMembers" placeholder="Comma-separated Member Names"><br><br>
    <input id="teamLogo" placeholder="Logo Image URL (optional)"><br><br>
    <button onclick="addTeam()">Add Team</button>
  </div>

  <div id="teams"></div>

  <div class="login-form" id="loginBox">
    <h3>üîê Admin Login</h3>
    <input id="adminPassword" type="password" placeholder="Enter Admin Password">
    <br>
    <button onclick="verifyPassword()">Login</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc, onSnapshot, doc, updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAmDBelUbSmLhY1VFIw2DiQvTRHqrG0kAk",
        authDomain: "team-scoreboard-1ce77.firebaseapp.com",
        projectId: "team-scoreboard-1ce77",
        storageBucket: "team-scoreboard-1ce77.firebasestorage.app",
        messagingSenderId: "109272670537",
        appId: "1:109272670537:web:50ef6884762c7aef5efa98",
        measurementId: "G-36QW4J7PHM"
    };

    const ADMIN_PASSWORD = "secret123";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const teamsRef = collection(db, "teams");

    let isAdmin = false;
    let teamList = [];

    function renderTeams(teams) {
      const container = document.getElementById("teams");
      container.innerHTML = "";
      teams.sort((a, b) => b.score - a.score);
      const medals = ["ü•á", "ü•à", "ü•â"];

      teams.forEach((team, index) => {
        const div = document.createElement("div");
        div.className = "team";
        const name = team.name || "Unnamed Team";
        const members = Array.isArray(team.members) ? team.members : [];
        const logoHtml = team.logo ? `<img src="${team.logo}" class="team-logo"><br>` : "";
        const membersHtml = members.map(m => `<li>${m}</li>`).join("");

        div.innerHTML = `
          ${logoHtml}
          <h2>${medals[index] || ""} <span id="name-${team.id}">${name}</span></h2>
          <input type="text" id="editName-${team.id}" class="edit-input hidden" value="${name}">
          <div class="score">Score: ${team.score}</div>
          <button onclick="updateScore('${team.id}', 1)">+1</button>
          <button onclick="updateScore('${team.id}', -1)">-1</button><br>
          <strong>Members:</strong>
          <ul class="member-list" id="members-${team.id}">${membersHtml}</ul>
          <input type="text" id="editMembers-${team.id}" class="edit-input hidden" value="${members.join(', ')}">
          <br>
          ${isAdmin ? `
            <button onclick="toggleEdit('${team.id}')">‚úèÔ∏è Edit</button>
            <button onclick="saveEdit('${team.id}')" id="save-${team.id}" class="hidden">üíæ Save</button>
          ` : ""}
        `;

        container.appendChild(div);
      });
    }

    onSnapshot(teamsRef, snapshot => {
      teamList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderTeams(teamList);
    });

    window.verifyPassword = function () {
      const pw = document.getElementById("adminPassword").value.trim();
      if (pw === ADMIN_PASSWORD) {
        isAdmin = true;
        document.getElementById("addEditContainer").classList.remove("hidden");
        document.getElementById("loginBox").classList.add("hidden");
        renderTeams(teamList);
      } else {
        alert("Incorrect password");
      }
    };

    window.addTeam = async function () {
      if (!isAdmin) return;
      const name = document.getElementById("teamName").value.trim();
      const memberInput = document.getElementById("teamMembers").value.trim();
      const logo = document.getElementById("teamLogo").value.trim();

      if (!name || !memberInput) {
        alert("Please enter team name and at least one member.");
        return;
      }

      const members = memberInput.split(",").map(m => m.trim()).filter(Boolean);

      await addDoc(teamsRef, {
        name,
        members,
        logo,
        score: 0
      });

      document.getElementById("teamName").value = "";
      document.getElementById("teamMembers").value = "";
      document.getElementById("teamLogo").value = "";
    };

    window.updateScore = async function (id, delta) {
      const team = teamList.find(t => t.id === id);
      if (!team) return;

      const ref = doc(db, "teams", id);
      await updateDoc(ref, { score: team.score + delta });
    };

    window.toggleEdit = function (id) {
      document.getElementById(`name-${id}`).style.display = "none";
      document.getElementById(`editName-${id}`).classList.remove("hidden");
      document.getElementById(`members-${id}`).style.display = "none";
      document.getElementById(`editMembers-${id}`).classList.remove("hidden");
      document.getElementById(`save-${id}`).classList.remove("hidden");
    };

    window.saveEdit = async function (id) {
      const newName = document.getElementById(`editName-${id}`).value.trim();
      const newMembers = document.getElementById(`editMembers-${id}`).value.trim().split(",").map(m => m.trim()).filter(Boolean);

      const ref = doc(db, "teams", id);
      await updateDoc(ref, {
        name: newName,
        members: newMembers
      });
    };
  </script>
</body>
</html>
